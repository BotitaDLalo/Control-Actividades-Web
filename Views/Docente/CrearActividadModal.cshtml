@{
    ViewData["Title"] = "CrearActividadModal";
}


<div class="modal fade" id="crearActividadModal" tabindex="-1" aria-labelledby="crearActividadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="crearActividadModalLabel">Crear Actividad</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="actividadesForm">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" class="form-control" autocomplete="off" autocorrect="off" spellcheck="false">

                    <label for="descripcion">Descripción:</label>
                    <textarea id="descripcion" class="form-control"></textarea>

                    <label for="fechaLimite">Fecha y Hora Límite de Entrega:</label>
                    <input type="datetime-local" id="fechaHoraLimite" class="form-control">

                    <label for="tipoActividad">Tipo de actividad:</label>
                    <select id="tipoActividad" class="form-select">
                        <option value="">Cargando...</option>
                    </select>

                    <label for="puntaje">Puntaje:</label>
                    <input type="number" id="puntaje" class="form-control" min="0" max="100">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnPublicarActividad">Publicar</button>
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#sugerenciasModal" id="btnSugerencias">Sugerencias</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="sugerenciasModal" tabindex="-1" aria-labelledby="sugerenciasModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sugerenciasModalLabel">Sugerencias</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div id="sugerenciasLista" class="list-group">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnAplicarSugerencia">
                    Aceptar
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Cargar tipos de actividades cuando se abra el modal
    document.addEventListener('DOMContentLoaded', function () {
        var crearModal = document.getElementById('crearActividadModal');
        if (crearModal) {
            crearModal.addEventListener('show.bs.modal', function () {
                cargarTiposActividad();
            });

            // Cuando se oculta el modal, restablecer al modo de creación
            crearModal.addEventListener('hidden.bs.modal', function () {
                try {
                    // limpiar formulario
                    var form = document.getElementById('actividadesForm');
                    if (form) form.reset();

                    // restaurar texto y comportamiento del botón publicar
                    var btn = document.getElementById('btnPublicarActividad');
                    if (btn) {
                        btn.textContent = 'Publicar';
                        // quitar listeners previos
                        var newBtn = btn.cloneNode(true);
                        btn.parentNode.replaceChild(newBtn, btn);
                        newBtn.addEventListener('click', registrarActividad);
                    }

                    // limpiar variable global de edición si existe
                    if (window.editingActividadId) window.editingActividadId = null;
                } catch (e) { console.warn(e); }
            });

            // asociar el comportamiento por default al botón (crear)
            var defaultBtn = document.getElementById('btnPublicarActividad');
            if (defaultBtn) defaultBtn.addEventListener('click', registrarActividad);
        }
    });

    async function cargarTiposActividad() {
        var select = document.getElementById('tipoActividad');
        if (!select) return;
        select.innerHTML = '<option value="">Cargando...</option>';
        try {
            const resp = await fetch('/Actividades/ObtenerTiposActividades');
            if (!resp.ok) throw new Error('No se pudieron cargar los tipos');
            const tipos = await resp.json();
            if (!tipos || tipos.length === 0) {
                select.innerHTML = '<option value="">(Sin tipos disponibles)</option>';
                return;
            }
            select.innerHTML = '';
            tipos.forEach(function (t) {
                var opt = document.createElement('option');
                opt.value = t.TipoActividadId;
                opt.textContent = t.Nombre;
                select.appendChild(opt);
            });
        } catch (e) {
            select.innerHTML = '<option value="">Error al cargar</option>';
            console.error(e);
        }
    }
</script>


